# Распределение адресного пространства
Цель: оптимальным образом распределить адресное пространство на устройства сети, чтобы обеспечить удобную навигацию, маршрутизацию и масштабируемость.
при распределении будим исходить из следующих установок:
1. Адреса подберём из сети 172.16.0.0/12
2. Структура адреса для p2p соединений будет следующая: 172.2Sp.Lf.X/31
где:
Sp - номер Spine (ОГРАНИЧЕНО 10ю SPINE. На практике, редко будет больше. Если предусмотрено расширение, то необходимо сменить диапазон)
Lf- номер Leaf (ОГРАНИЧЕНО 255ю LEAF)
X - номер линка умноженный на 2. Первый адрес из сети будет прописан на Spine, а второй на Leaf
3. Адреса для loopback будем брать из двух подсетей 172.16.0.0/16 для loopback1 и 172.17.0.0/16 для loopback2
На leaf создадим три VLAN куда будут подключаться клиенты. На первых двух по одной и два на третьем. Vlan второго leaf будет создан на третьем. 
Адреса для Vlan будут следующие:
Vlan8 - 172.20.8.0/24
vlan10 - 172.20.10.0/24
vlan11 - 172.20.11.0/24
Последние адреса сетей, перед бродкастовым, будут выступать в качестве шлюзов
## Пути оптимизации адресного пространства
Вышеуказанные критерии выбора адресов, например выбор адресов для p2p, не оптимальна, но удобна для проведения лабораторной. Поэтому укажем пути оптимизации адресного пространства.
Так, к примеру, адрес принадлежащий Spine можно указывать во втором октете, а адреса Leaf выбирать последовательно из последнего октета, где номер чётного числа будет равен номеру leaf. Иными словами, если вы хотите узнать номер Leaf то последнюю цифру адреса порта на Spine поделите на два. Таким образом первый адрес из сети /31 будет принадлежать Spine, а второй Leaf. Нулевая подсеть будет пропущена.  
## Ход выполнения лабораторной
1. Сделаем линки соединяющие Leaf-Spine маршрутизируемыми, командой 
 
```
leaf-3#conf t
leaf-3(config)#int ethernet 1-2
leaf-3(config-if-Et1-2)#no switchport
```

 2. Присвоим адреса на интерфейсы, в результате получим следующую конфигурацию порта Spine-2 p2p to Leaf-2

 ```
 spine-2(config-if-Et2)#show active
interface Ethernet2
   description "link to Leaf-2"
   no switchport
   ip address 172.22.2.2/31
```
3. Проверим связность для каждого линка
```
spine-1(config-if-Et3)#ping  172.21.1.3
PING 172.21.1.3 (172.21.1.3) 72(100) bytes of data.
80 bytes from 172.21.1.3: icmp_seq=1 ttl=64 time=39.8 ms
80 bytes from 172.21.1.3: icmp_seq=2 ttl=64 time=27.9 ms
80 bytes from 172.21.1.3: icmp_seq=3 ttl=64 time=38.2 ms
80 bytes from 172.21.1.3: icmp_seq=4 ttl=64 time=29.6 ms
80 bytes from 172.21.1.3: icmp_seq=5 ttl=64 time=3.07 ms
```
4. Пропишем адреса на интерфейсах Loopback всех коммутаторов
```
spine-1#sho run int loopback 1
interface Loopback1
   ip address 172.16.0.1/32
```
На этом настройка Spine закончена. Сохраняем конфигурацию
```
spine-2#write memory
```
5. Пропишем Vlan на Leaf и пропишем адреса на SVI
```
leaf-3(config-if-Vl10-11)#show active
interface Vlan10
   ip address 172.20.10.254/24
interface Vlan11
   ip address 172.20.11.254/24
```
6. Добавим интерфейсы в vlan
```
leaf-3(config)#int eth 3
leaf-3(config-if-Et3)#sw acce vl 10
leaf-3(config-if-Et3)#int eth 4
leaf-3(config-if-Et4)#sw acce vl 11
```
На этом настройка leaf закончена. Сохраняем конфигурацию.

7. Настроим адреса на интерфейсах linux машин
Для настройки сети lunux отредактируем файл `/etc/netplan/00-installer-config.yaml` добавив в него адреса на интерфейсах и дефолнтный маршрут. К примеру, так будет выглядеть файл на втором сервере:
```
network:
  version: 2
  ethernets:
    ens3:
      dhcp4: true
    ens4:
      dhcp4: false
      addresses: [172.20.10.2/24]
      routes:
        - to: 0.0.0.0/0
          via: 172.20.10.254
```
8. Проверка работы схемы
Проверим доступность SVI от серверов, на примере третьего сервера:
```
eve@srv3:~$ ping 172.20.10.254
PING 172.20.10.254 (172.20.10.254) 56(84) bytes of data.
64 bytes from 172.20.10.254: icmp_seq=1 ttl=64 time=50.4 ms
64 bytes from 172.20.10.254: icmp_seq=2 ttl=64 time=4.02 ms
64 bytes from 172.20.10.254: icmp_seq=3 ttl=64 time=3.21 ms
```
Проверим доступность интерфейса loopback 1 на leaf от сервера на примере 4го сервера
```
eve@srv4:~$ ping 172.16.1.3
PING 172.16.1.3 (172.16.1.3) 56(84) bytes of data.
64 bytes from 172.16.1.3: icmp_seq=1 ttl=64 time=10.5 ms
64 bytes from 172.16.1.3: icmp_seq=2 ttl=64 time=2.58 ms
64 bytes from 172.16.1.3: icmp_seq=3 ttl=64 time=2.69 ms
```
Проверить, доступность Spine от серверов, не получится, так как Spine не имеют информации о сетях Linux машин.
